////////////////////////////////////////////////////////////////////////////////////////////////////
//                               This file is part of CosmoScout VR                               //
//      and may be used under the terms of the MIT license. See the LICENSE file for details.     //
//                        Copyright: (c) 2019 German Aerospace Center (DLR)                       //
////////////////////////////////////////////////////////////////////////////////////////////////////

#include "RenderDataDEM.hpp"

#include "../../../src/cs-utils/utils.hpp"

////////////////////////////////////////////////////////////////////////////////////////////////////

namespace csp::lodbodies {

////////////////////////////////////////////////////////////////////////////////////////////////////

/* explicit */
RenderDataDEM::RenderDataDEM(TileNode* node)
    : RenderData(node)
    , mLodDeltas()
    , mEdgeRData()
    , mFlags(0) {
  resetEdgeDeltas();
  resetEdgeRData();
}

////////////////////////////////////////////////////////////////////////////////////////////////////

/* virtual */
RenderDataDEM::~RenderDataDEM() = default;

////////////////////////////////////////////////////////////////////////////////////////////////////

int RenderDataDEM::getEdgeDelta(int idx) const {
  return mLodDeltas.at(idx);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void RenderDataDEM::setEdgeDelta(int idx, int delta) {
  mLodDeltas.at(idx) = static_cast<glm::int8>(delta);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void RenderDataDEM::resetEdgeDeltas() {
  for (signed char& mLodDelta : mLodDeltas) {
    mLodDelta = 0;
  }
}

////////////////////////////////////////////////////////////////////////////////////////////////////

RenderDataDEM* RenderDataDEM::getEdgeRData(int idx) const {
  return mEdgeRData.at(idx);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void RenderDataDEM::setEdgeRData(int idx, RenderDataDEM* rdata) {
  mEdgeRData.at(idx) = rdata;
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void RenderDataDEM::resetEdgeRData() {
  for (auto& i : mEdgeRData) {
    i = nullptr;
  }
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void RenderDataDEM::addFlag(Flags flag) {
  mFlags |= static_cast<glm::uint8>(flag);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void RenderDataDEM::subFlag(Flags flag) {
  mFlags &= ~static_cast<glm::uint8>(flag);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

bool RenderDataDEM::testFlag(Flags flag) const {
  return mFlags & static_cast<glm::uint8>(flag);
}

////////////////////////////////////////////////////////////////////////////////////////////////////

glm::uint8 RenderDataDEM::getFlags() const {
  return mFlags;
}

////////////////////////////////////////////////////////////////////////////////////////////////////

void RenderDataDEM::clearFlags() {
  mFlags = 0x00;
}

////////////////////////////////////////////////////////////////////////////////////////////////////

RenderDataDEM::Flags operator&(RenderDataDEM::Flags lhs, RenderDataDEM::Flags rhs) {
  return RenderDataDEM::Flags(static_cast<int>(lhs) & static_cast<int>(rhs));
}

////////////////////////////////////////////////////////////////////////////////////////////////////

RenderDataDEM::Flags operator|(RenderDataDEM::Flags lhs, RenderDataDEM::Flags rhs) {
  return RenderDataDEM::Flags(static_cast<int>(lhs) | static_cast<int>(rhs));
}

////////////////////////////////////////////////////////////////////////////////////////////////////

RenderDataDEM::Flags& operator&=(RenderDataDEM::Flags& lhs, RenderDataDEM::Flags rhs) {
  return lhs = lhs & rhs;
}

////////////////////////////////////////////////////////////////////////////////////////////////////

RenderDataDEM::Flags& operator|=(RenderDataDEM::Flags& lhs, RenderDataDEM::Flags rhs) {
  return lhs = lhs | rhs;
}

////////////////////////////////////////////////////////////////////////////////////////////////////

RenderDataDEM::Flags operator~(RenderDataDEM::Flags lhs) {
  return RenderDataDEM::Flags(~static_cast<int>(lhs));
}

////////////////////////////////////////////////////////////////////////////////////////////////////

std::ostream& operator<<(std::ostream& os, RenderDataDEM::Flags flags) {
  os << "(";

  if (flags & cs::utils::enumCast(RenderDataDEM::Flags::eRender)) {
    os << "Render";
  }

  os << ")";

  return os;
}

////////////////////////////////////////////////////////////////////////////////////////////////////

} // namespace csp::lodbodies
