language: cpp
addons:
  apt:
    update: true
    packages:
      - g++-7
      - clang-6.0
      - libc++-dev
      - libgl1-mesa-dev
      - libglu1-mesa-dev
      - libx11-dev
      - libxi-dev
      - libgconf-2-4
      - libboost1.70-dev
    sources:
      - sourceline: 'ppa:mhier/libboost-latest'
cache:
  ccache: true
  directories:
  - build/linux-externals
  - build/windows-externals
matrix:
  include:
    - name: Linux GCC
      env: LABEL=LinuxGCC
      os: linux
      dist: bionic
      sudo: required
      before_script:
        - CC=gcc-7
        - CXX=g++-7
    - name: Linux Clang
      env: LABEL=LinuxClang
      os: linux
      dist: bionic
      sudo: required
      before_script:
        - CC=clang-6.0
        - CXX=clang++-6.0
    - name: Windows MSVC
      env: LABEL=WindowsMSVC
      os: windows
  allow_failures:
    - os: windows
script:
  - |
    if [ "$TRAVIS_OS_NAME" == "windows" ]; then
      cmd "/C make_externals.bat"
      cmd "/C make_release.bat"
    else
      ./make_externals.sh --with-ccache
      ./make_release.sh --with-ccache
    fi
notifications:
  webhooks:
    urls:
      - https://webhooks.gitter.im/e/4ff52b66ca51dd75a045
    on_success: change
    on_failure: always
    on_start: never

